<?xml version="1.0"?>
<configuration>
  <configSections>
    <sectionGroup name="SourceContent">
      <section name="WebSourceContent" type="SPF.Configuration.WebSourceConfiguration, SPF"/>
      <section name="SqlSourceContent" type="SPF.Configuration.SqlSourceConfiguration,SPF"/>
    </sectionGroup>
  </configSections>

  <SourceContent>
    <WebSourceContent>

      <source key="StaticContent" baseUrl="static\xml\">
        <cache enable="true" cacheDuration="30"/>

        <item key="article\?id=(?'id'[0-9]+)" contentType="POX" type="Website.ArticleInfo, Website">
          <cache enable="true" cacheDuration="7200" fallback="true"/>
          <proccessors>
            <proccessor name="XsltTransformer" type="SPF.Web.XsltTransformProccessor,SPF">
              <xsltPath url="xslt\article.xslt"/>
              <xsltArgs>
                <add key="id" value="${id}"/>
                <add key="classId" value="1"/>
              </xsltArgs>
            </proccessor>
            <proccessor name="ContentLoader" type="SPF.Data.WebContentLoadProccessor,SPF">
              <resources>
                <add key="articleContent" url="article${id}.xml"/>
              </resources>
            </proccessor>
          </proccessors>
        </item>

      </source>

      <source key="PollService" baseUrl="http://localhost:9340/">
        <cache enable="false" cacheDuration="0"/>

        <item key="poll" contentType="WEBFORM">
          <httpParam verb="POST"/>
          <cache enable="false"/>
          <proccessors>
            <proccessor name="CustomTransformer" type="Website.ArticleTransformer,Website"/>
            <proccessor name="ContentExecutor" type="SPF.Data.WebContentExecuteProccessor,SPF">
              <resources>
                <add key="postUrl" url="poll.aspx"/>
              </resources>
            </proccessor>
          </proccessors>
        </item>

      </source>


    </WebSourceContent>

    <SqlSourceContent>
      <source key="SqlCommand" connectionPorfile="connWork">

        <item key="GetUserById/?id=(?'id'[0-9]+)" type="Website.UserInfo,Website">
          <cache enable="false" cacheDuration="0"/>
          <proccessors>
            <proccessor name="SqlObjectMappingProccessor" type="SPF.Sql.SqlObjectMappingProccessor,SPF">
              <mapping>
                <add objectValue="UID" sqlValue="uid"/>
                <add objectValue="UName" sqlValue="uname"/>
                <add objectValue="UPass" sqlValue="upass"/>
                <add objectValue="UPassQuiz" sqlValue="upass_quiz"/>
                <add objectValue="UPassAnswer" sqlValue="upass_answer"/>
                <add objectValue="RoleID" sqlValue="roleId"/>
                <add objectValue="RoleName" sqlValue="roleName"/>
              </mapping>
            </proccessor>
            <proccessor name="ContentLoader" type="SPF.Data.SqlContentLoadProccessor,SPF">
              <sqlCommand name="SqlCommand" commandType="Text" text="SELECT [uid]
      ,[uname]
      ,[upass]
      ,[email]
      ,[upass_quiz]
      ,[upass_answer]
      ,[roleId]
      ,[roleName]
  FROM [ebbok].[dbo].[View_UserInfo] WHERE uid=${uid}">
              </sqlCommand>
              <sqlArgs>
                <add key="uid" value="${uid}"/>
              </sqlArgs>
            </proccessor>
          </proccessors>
        </item>

        <item key="AddLibInfo">
          <proccessors>
            <proccessor name="ContentExecuter" type="SPF.Data.SqlContentExecuteProcessor,SPF">
              <sqlCommand name="SqlCommand" commandType="Text" text="INSERT INTO [ebbok].[dbo].[library_profile]
           ([libName]
           ,[libAddress]
           ,[libPhone])
     VALUES
           ('${libName}'
           ,'${libAddress}'
           ,'${libPhone}')
           SELECT @@IDENTITY">
              </sqlCommand>
              <sqlArgs>
                <add key="libName" value="${libName}"/>
                <add key="libAddress" value="${libAddress}"/>
                <add key="libPhone" value="${libPhone}"/>
              </sqlArgs>
            </proccessor>
          </proccessors>
        </item>

        <item key="AddComment/?articleId=(?'articleId'[0-9]+)&amp;userId=(?'userId'[0-9]+)">
          <proccessors>
            <proccessor name="TranscationExecuter" type="SPF.Data.SqlContentTransactionProcessor,SPF">
              <sqlCommand name="AddCommentsProfile" text=" INSERT INTO [ebbok].[dbo].[comments_profile] ([commentContent],[commentStatus]) VALUES ('${commentsContent}',${commentsStatus}) SELECT @@IDENTITY"/>
              <sqlCommand name="AddComments_Related" text=" INSERT INTO [ebbok].[dbo].[comments_related] ([commentId],[articleId],[userId]) VALUES (@@IDENTITY,${articleId},${userId})"/>
              <sqlArgs>
                <add key="commentsContent" value="${commentsContent}"/>
                <add key="commentsStatus" value="0"/>
                <add key="articleId" value="${articleId}"/>
                <add key="userId" value="${userId}"/>
              </sqlArgs>
            </proccessor>
          </proccessors>
        </item>

      </source>
    </SqlSourceContent>
  </SourceContent>


  <connectionStrings>
    <add name="connWork" connectionString="Data Source=LEEYON-2008\SQLEXPRESS;Initial Catalog=testbase;User ID=sa;Password=root"/>
    <add name="connHome" connectionString="Data Source=WIN-EJ34CN82D13\SQLEXPRESS;Initial Catalog=ebook;User ID=sa;Password=root"/>
  </connectionStrings>
  <system.web>
    <compilation debug="true" targetFramework="4.0" />
  </system.web>

</configuration>
